<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Math Playland</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&family=Nunito:wght@400;600;700;800&display=swap');

        :root {
            --background: 45 100% 96%;
            --foreground: 250 30% 25%;

            --card: 0 0% 100%;
            --card-foreground: 250 30% 25%;

            --primary: 173 58% 45%;
            --primary-foreground: 0 0% 100%;

            --secondary: 280 45% 65%;
            --secondary-foreground: 0 0% 100%;

            --muted: 45 40% 90%;
            --muted-foreground: 250 20% 45%;

            --accent: 35 95% 60%;
            --accent-foreground: 250 30% 20%;

            --destructive: 0 75% 60%;
            --destructive-foreground: 0 0% 100%;

            --coral: 10 80% 65%;
            --coral-foreground: 0 0% 100%;

            --success: 145 60% 45%;
            --success-foreground: 0 0% 100%;

            --border: 45 30% 85%;
            --radius: 1rem;
            --radius-lg: 1.5rem;
            --radius-xl: 2rem;

            --gradient-fun: linear-gradient(135deg, hsl(173 58% 45%), hsl(280 45% 65%));
            --gradient-warm: linear-gradient(135deg, hsl(10 80% 65%), hsl(35 95% 60%));
            --gradient-cool: linear-gradient(135deg, hsl(200 80% 60%), hsl(173 58% 45%));
            --gradient-bg: linear-gradient(180deg, hsl(45 100% 96%) 0%, hsl(45 60% 92%) 100%);

            --shadow-playful: 0 8px 30px -10px hsl(250 30% 25% / 0.15);
            --shadow-button: 0 4px 15px -3px hsl(250 30% 25% / 0.2);
        }

        /* Reset & Base */
        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background: var(--gradient-bg);
            color: hsl(var(--foreground));
            min-height: 100vh;
            padding: 2rem 1rem;
            user-select: none;
            -webkit-user-select: none;
        }

        button {
            border: none;
            background: none;
            cursor: pointer;
            font-family: inherit;
            color: inherit;
            -webkit-tap-highlight-color: transparent;
        }

        /* Typography */
        .font-fredoka { font-family: 'Fredoka', sans-serif; }
        .font-nunito { font-family: 'Nunito', sans-serif; }
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .font-bold { font-weight: 700; }
        .font-semibold { font-weight: 600; }

        .text-title { font-size: 2.5rem; margin-bottom: 0.5rem; }
        .text-subtitle { font-size: 1.125rem; color: hsl(var(--muted-foreground)); }
        .text-display { font-size: 3rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .text-sub-display { font-size: 1.125rem; color: hsl(var(--muted-foreground)); height: 1.75rem; }

        @media (min-width: 768px) {
            .text-title { font-size: 3rem; }
            .text-display { font-size: 4rem; }
        }

        /* Colors */
        .text-success { color: hsl(var(--success)); }
        .text-destructive { color: hsl(var(--destructive)); }
        .text-accent { color: hsl(var(--accent)); }
        .text-muted { color: hsl(var(--muted-foreground)); }

        /* Layout Utilities */
        .container { max-width: 24rem; margin: 0 auto; }
        .flex-center { display: flex; justify-content: center; align-items: center; }
        .flex-between { display: flex; justify-content: space-between; align-items: center; }
        .flex-gap { display: flex; gap: 0.5rem; }
        .grid-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.75rem; }
        .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.75rem; }
        .col-span-2 { grid-column: span 2; }
        .mb-lg { margin-bottom: 2rem; }
        .mb-md { margin-bottom: 1.5rem; }
        .mb-sm { margin-bottom: 1rem; }
        .mx-auto { margin-left: auto; margin-right: auto; }
        .hidden { display: none !important; }
        .w-full { width: 100%; }
        .relative { position: relative; }

        /* Components */
        .card {
            background-color: hsl(var(--card));
            border-radius: var(--radius-xl);
            padding: 1.5rem;
            box-shadow: var(--shadow-playful);
        }

        .display-area {
            background-color: hsl(var(--muted));
            border-radius: var(--radius);
            padding: 1rem;
            margin-bottom: 1.5rem;
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            border-radius: var(--radius);
            font-family: 'Fredoka', sans-serif;
            font-weight: 600;
            transition: all 0.2s;
            box-shadow: var(--shadow-button);
        }
        .btn svg { pointer-events: none; } /* Ensure clicks hit the button */
        .btn:hover { transform: scale(1.05); }
        .btn:active { transform: scale(0.95); }

        /* Button Sizes */
        .btn-lg { padding: 0.75rem 1.5rem; font-size: 1.125rem; }
        .btn-sq { width: 4rem; height: 4rem; font-size: 1.5rem; }
        .btn-sq-sm { width: 3.5rem; height: 3.5rem; font-size: 1.5rem; }
        .btn-full { width: 100%; padding: 1rem; font-size: 1.25rem; }

        @media (min-width: 768px) {
            .btn-sq { width: 5rem; height: 5rem; font-size: 2rem; }
        }

        /* Button Variants */
        .btn-tab {
            color: hsl(var(--muted-foreground));
            background: transparent;
            box-shadow: none;
        }
        .btn-tab:hover { color: hsl(var(--foreground)); }
        .btn-tab.active {
            color: hsl(var(--primary-foreground));
            box-shadow: var(--shadow-button);
        }
        .btn-tab.active[data-tab="calculator"] { background: var(--gradient-cool); }
        .btn-tab.active[data-tab="game"] { background: var(--gradient-warm); }

        .btn-primary { background: hsl(var(--primary)); color: hsl(var(--primary-foreground)); }
        .btn-destructive { background: hsl(var(--destructive)); color: hsl(var(--destructive-foreground)); }
        .btn-muted { background: hsl(var(--muted)); color: hsl(var(--foreground)); }
        .btn-coral { background: hsl(var(--coral)); color: hsl(var(--coral-foreground)); }
        .btn-card { 
            background: hsl(var(--card)); 
            color: hsl(var(--foreground)); 
            border: 2px solid hsl(var(--border));
        }

        .btn-cool { background: var(--gradient-cool); color: hsl(var(--primary-foreground)); }
        .btn-fun { background: var(--gradient-fun); color: hsl(var(--primary-foreground)); }
        .btn-warm { background: var(--gradient-warm); color: hsl(var(--primary-foreground)); }

        /* Animations */
        .fade-in { animation: fadeIn 0.5s ease-out forwards; opacity: 0; }
        .slide-up { animation: slideUp 0.5s ease-out forwards; opacity: 0; transform: translateY(20px); }

        @keyframes fadeIn { to { opacity: 1; } }
        @keyframes slideUp { to { opacity: 1; transform: translateY(0); } }

        .animate-bounce { animation: bounce 2s infinite; }
        @keyframes bounce {
            0%, 100% { transform: translateY(-10%); }
            50% { transform: translateY(10%); }
        }

        .animate-pop { animation: pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes pop {
            0% { transform: scale(0); }
            100% { transform: scale(1); }
        }

        /* Tab Logic */
        .tab-content { display: none; animation: fadeIn 0.3s ease-out; }
        .tab-content.active { display: block; }

        /* Overlays */
        .overlay {
            display: none;
            position: absolute;
            inset: 0;
            background-color: rgba(255, 255, 255, 0.5);
            backdrop-filter: blur(4px);
            z-index: 50;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-xl);
        }
        .overlay.active { display: flex; animation: fadeIn 0.3s ease-out; }
    </style>
</head>
<body>

    <!-- Header -->
    <div class="text-center mb-lg fade-in">
        <h1 class="text-title font-fredoka font-bold">
            Math Fun
        </h1>
        <p class="text-subtitle font-nunito">
            Calculate and play your way to math mastery!
        </p>
    </div>

    <!-- Tab Switcher -->
    <div class="flex-center mb-lg">
        <div class="card flex-gap" style="padding: 0.5rem; border-radius: 1rem;">
            <button id="tab-calculator" data-tab="calculator" class="btn btn-lg btn-tab active">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/></svg>
                Calculator
            </button>
            <button id="tab-game" data-tab="game" class="btn btn-lg btn-tab">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="6" x2="10" y1="11" y2="11"/><line x1="8" x2="8" y1="9" y2="13"/><line x1="15" x2="15.01" y1="13" y2="13"/><line x1="18" x2="18.01" y1="11" y2="11"/><rect width="20" height="12" x="2" y="6" rx="2"/></svg>
                Math Game
            </button>
        </div>
    </div>

    <!-- Content Area -->
    <div class="container">
        
        <!-- Calculator -->
        <div id="content-calculator" class="tab-content active">
            <div class="card slide-up">
                <div class="display-area">
                    <div id="calc-display" class="text-display font-fredoka font-bold text-right">0</div>
                    <div id="calc-sub-display" class="text-sub-display font-nunito text-right"></div>
                </div>

                <div class="grid-4">
                    <button data-calc-action="clear" class="btn btn-sq btn-destructive">AC</button>
                    <button data-calc-action="sign" class="btn btn-sq btn-muted">±</button>
                    <button data-calc-action="percent" class="btn btn-sq btn-muted">%</button>
                    <button data-calc-action="operator" data-calc-value="÷" class="btn btn-sq btn-coral">÷</button>

                    <button data-calc-action="number" data-calc-value="7" class="btn btn-sq btn-card">7</button>
                    <button data-calc-action="number" data-calc-value="8" class="btn btn-sq btn-card">8</button>
                    <button data-calc-action="number" data-calc-value="9" class="btn btn-sq btn-card">9</button>
                    <button data-calc-action="operator" data-calc-value="×" class="btn btn-sq btn-coral">×</button>

                    <button data-calc-action="number" data-calc-value="4" class="btn btn-sq btn-card">4</button>
                    <button data-calc-action="number" data-calc-value="5" class="btn btn-sq btn-card">5</button>
                    <button data-calc-action="number" data-calc-value="6" class="btn btn-sq btn-card">6</button>
                    <button data-calc-action="operator" data-calc-value="-" class="btn btn-sq btn-coral">-</button>

                    <button data-calc-action="number" data-calc-value="1" class="btn btn-sq btn-card">1</button>
                    <button data-calc-action="number" data-calc-value="2" class="btn btn-sq btn-card">2</button>
                    <button data-calc-action="number" data-calc-value="3" class="btn btn-sq btn-card">3</button>
                    <button data-calc-action="operator" data-calc-value="+" class="btn btn-sq btn-coral">+</button>

                    <button data-calc-action="number" data-calc-value="0" class="btn btn-sq btn-card col-span-2" style="width: 100%;">0</button>
                    <button data-calc-action="decimal" class="btn btn-sq btn-card">.</button>
                    <button data-calc-action="calculate" class="btn btn-sq btn-primary">=</button>
                </div>
            </div>
        </div>

        <!-- Math Game -->
        <div id="content-game" class="tab-content">
            
            <!-- Game Menu -->
            <div id="game-menu" class="card slide-up text-center" style="padding: 2rem;">
                <div class="mb-md animate-bounce">
                    <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mx-auto text-primary"><line x1="6" x2="10" y1="11" y2="11"/><line x1="8" x2="8" y1="9" y2="13"/><line x1="15" x2="15.01" y1="13" y2="13"/><line x1="18" x2="18.01" y1="11" y2="11"/><rect width="20" height="12" x="2" y="6" rx="2"/></svg>
                </div>
                <h2 class="text-title font-fredoka font-bold">Math Adventure</h2>
                <p class="text-subtitle font-nunito mb-lg">Choose your level and start playing!</p>

                <div style="display: flex; flex-direction: column; gap: 1rem;">
                    <button data-game-difficulty="easy" class="btn btn-full btn-cool">
                        Easy (Addition)
                    </button>
                    <button data-game-difficulty="medium" class="btn btn-full btn-fun">
                        Medium (+/-)
                    </button>
                    <button data-game-difficulty="hard" class="btn btn-full btn-warm">
                        Hard (+/-/×)
                    </button>
                </div>
            </div>

            <!-- Game Board (Hidden by default) -->
            <div id="game-board" class="card slide-up relative hidden">
                <!-- Celebration Overlay -->
                <div id="celebration-overlay" class="overlay">
                    <div class="text-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-accent mx-auto mb-2"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/></svg>
                        <p id="celebration-text" class="text-title font-fredoka font-bold"></p>
                    </div>
                </div>

                <!-- Header -->
                <div class="flex-between mb-lg">
                    <div class="flex-center" style="gap: 0.5rem;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-accent"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>
                        <span id="game-score" class="font-fredoka font-bold" style="font-size: 1.25rem;">0</span>
                    </div>
                    <div id="game-streak-stars" class="flex-center" style="gap: 0.25rem;">
                        <!-- Stars will be injected here -->
                    </div>
                    <button id="btn-game-back" class="btn btn-muted" style="padding: 0.5rem;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>
                    </button>
                </div>

                <!-- Problem -->
                <div class="display-area text-center">
                    <div id="game-problem" class="text-title font-fredoka font-bold mb-sm">
                        <!-- 10 + 5 = ? -->
                    </div>

                    <div id="game-answer-display" class="font-fredoka font-bold" style="font-size: 3rem; padding: 0.5rem 1rem;">
                        _
                    </div>

                    <p id="game-feedback" class="font-nunito font-semibold" style="height: 1.5rem; margin-top: 0.5rem;"></p>
                </div>

                <!-- Numpad -->
                <div class="grid-3">
                    <button data-game-num="1" class="btn btn-sq-sm btn-card">1</button>
                    <button data-game-num="2" class="btn btn-sq-sm btn-card">2</button>
                    <button data-game-num="3" class="btn btn-sq-sm btn-card">3</button>
                    
                    <button data-game-num="4" class="btn btn-sq-sm btn-card">4</button>
                    <button data-game-num="5" class="btn btn-sq-sm btn-card">5</button>
                    <button data-game-num="6" class="btn btn-sq-sm btn-card">6</button>

                    <button data-game-num="7" class="btn btn-sq-sm btn-card">7</button>
                    <button data-game-num="8" class="btn btn-sq-sm btn-card">8</button>
                    <button data-game-num="9" class="btn btn-sq-sm btn-card">9</button>

                    <button id="btn-game-clear" class="btn btn-sq-sm btn-destructive" style="font-size: 1.25rem;">C</button>
                    <button data-game-num="0" class="btn btn-sq-sm btn-card">0</button>
                    <button id="btn-game-backspace" class="btn btn-sq-sm btn-muted">←</button>
                </div>

                <button id="btn-game-check" class="btn btn-full btn-fun" style="margin-top: 1rem;">
                    Check Answer
                </button>

            </div>
        </div>

    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- DOM Elements ---
        const tabs = {
            calculator: document.getElementById('tab-calculator'),
            game: document.getElementById('tab-game')
        };
        
        const contents = {
            calculator: document.getElementById('content-calculator'),
            game: document.getElementById('content-game')
        };

        // Calculator Elements
        const displayElement = document.getElementById('calc-display');
        const subDisplayElement = document.getElementById('calc-sub-display');
        const calcButtons = document.querySelectorAll('[data-calc-action]');

        // Game Elements
        const gameMenu = document.getElementById('game-menu');
        const gameBoard = document.getElementById('game-board');
        const scoreEl = document.getElementById('game-score');
        const streakContainer = document.getElementById('game-streak-stars');
        const problemEl = document.getElementById('game-problem');
        const answerDisplayEl = document.getElementById('game-answer-display');
        const feedbackEl = document.getElementById('game-feedback');
        const celebrationOverlay = document.getElementById('celebration-overlay');
        const celebrationText = document.getElementById('celebration-text');
        
        // Game Buttons
        const difficultyButtons = document.querySelectorAll('[data-game-difficulty]');
        const gameNumButtons = document.querySelectorAll('[data-game-num]');
        const btnGameBack = document.getElementById('btn-game-back');
        const btnGameCheck = document.getElementById('btn-game-check');
        const btnGameClear = document.getElementById('btn-game-clear');
        const btnGameBackspace = document.getElementById('btn-game-backspace');

        // --- State ---
        let calcState = {
            display: "0",
            prevValue: null,
            operation: null,
            waitingForOperand: false
        };

        let gameState = {
            difficulty: "easy",
            score: 0,
            streak: 0,
            problem: null,
            userAnswer: "",
            started: false
        };

        // --- Tab Logic ---
        function switchTab(tabName) {
            // Update Buttons
            Object.entries(tabs).forEach(([key, btn]) => {
                if (!btn) return;
                if (key === tabName) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });

            // Update Content
            Object.entries(contents).forEach(([key, content]) => {
                if (!content) return;
                if (key === tabName) {
                    content.classList.add('active');
                } else {
                    content.classList.remove('active');
                }
            });
        }

        if (tabs.calculator) tabs.calculator.addEventListener('click', () => switchTab('calculator'));
        if (tabs.game) tabs.game.addEventListener('click', () => switchTab('game'));

        // --- Calculator Logic ---
        function updateCalcDisplay() {
            if (displayElement) displayElement.textContent = calcState.display;
            if (subDisplayElement) {
                if (calcState.operation && calcState.prevValue) {
                    subDisplayElement.textContent = `${calcState.prevValue} ${calcState.operation}`;
                } else {
                    subDisplayElement.textContent = '';
                }
            }
        }

        function handleCalcInput(action, value) {
            switch (action) {
                case 'number':
                    if (calcState.waitingForOperand) {
                        calcState.display = value;
                        calcState.waitingForOperand = false;
                    } else {
                        calcState.display = calcState.display === "0" ? value : calcState.display + value;
                    }
                    break;
                case 'decimal':
                    if (calcState.waitingForOperand) {
                        calcState.display = "0.";
                        calcState.waitingForOperand = false;
                    } else if (!calcState.display.includes(".")) {
                        calcState.display += ".";
                    }
                    break;
                case 'clear':
                    calcState.display = "0";
                    calcState.prevValue = null;
                    calcState.operation = null;
                    calcState.waitingForOperand = false;
                    break;
                case 'sign':
                    calcState.display = String(parseFloat(calcState.display) * -1);
                    break;
                case 'percent':
                    calcState.display = String(parseFloat(calcState.display) / 100);
                    break;
                case 'operator':
                    const inputValue = parseFloat(calcState.display);
                    if (calcState.prevValue === null) {
                        calcState.prevValue = calcState.display;
                    } else if (calcState.operation) {
                        const result = calculate(parseFloat(calcState.prevValue), inputValue, calcState.operation);
                        calcState.display = String(result);
                        calcState.prevValue = String(result);
                    }
                    calcState.waitingForOperand = true;
                    calcState.operation = value;
                    break;
                case 'calculate':
                    if (!calcState.operation || calcState.prevValue === null) return;
                    const result = calculate(parseFloat(calcState.prevValue), parseFloat(calcState.display), calcState.operation);
                    calcState.display = String(result);
                    calcState.prevValue = null;
                    calcState.operation = null;
                    calcState.waitingForOperand = true;
                    break;
            }
            updateCalcDisplay();
        }

        function calculate(a, b, op) {
            switch (op) {
                case "+": return a + b;
                case "-": return a - b;
                case "×": return a * b;
                case "÷": return b !== 0 ? a / b : 0;
                default: return b;
            }
        }

        calcButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                handleCalcInput(btn.dataset.calcAction, btn.dataset.calcValue);
            });
        });

        // --- Math Game Logic ---
        function updateGameUI() {
            if (!gameMenu || !gameBoard) return;

            if (!gameState.started) {
                gameMenu.classList.remove('hidden');
                gameBoard.classList.add('hidden');
            } else {
                gameMenu.classList.add('hidden');
                gameBoard.classList.remove('hidden');
                
                if (scoreEl) scoreEl.textContent = gameState.score;
                if (problemEl && gameState.problem) {
                    problemEl.textContent = `${gameState.problem.num1} ${gameState.problem.operation} ${gameState.problem.num2} = ?`;
                }
                if (answerDisplayEl) answerDisplayEl.textContent = gameState.userAnswer || "_";
                
                // Render stars
                if (streakContainer) {
                    streakContainer.innerHTML = '';
                    const starCount = Math.min(gameState.streak, 5);
                    for (let i = 0; i < starCount; i++) {
                        const star = document.createElement('span');
                        star.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="hsl(var(--accent))" stroke="hsl(var(--accent))" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>`;
                        star.className = 'animate-pop inline-block';
                        streakContainer.appendChild(star);
                    }
                }
            }
        }

        function generateProblem() {
            const operations = gameState.difficulty === "easy" ? ["+"] : gameState.difficulty === "medium" ? ["+", "-"] : ["+", "-", "×"];
            const operation = operations[Math.floor(Math.random() * operations.length)];
            
            let maxNum = gameState.difficulty === "easy" ? 10 : gameState.difficulty === "medium" ? 20 : 12;
            let num1 = Math.floor(Math.random() * maxNum) + 1;
            let num2 = Math.floor(Math.random() * maxNum) + 1;
            
            // No negative answers
            if (operation === "-" && num2 > num1) {
                [num1, num2] = [num2, num1];
            }
            
            let answer = 0;
            switch (operation) {
                case "+": answer = num1 + num2; break;
                case "-": answer = num1 - num2; break;
                case "×": answer = num1 * num2; break;
            }
            
            gameState.problem = { num1, num2, operation, answer };
            gameState.userAnswer = "";
            
            // Reset UI feedback
            if (answerDisplayEl) {
                answerDisplayEl.classList.remove('text-success', 'text-destructive');
            }
            if (feedbackEl) feedbackEl.textContent = '';
            
            updateGameUI();
        }

        function checkAnswer() {
            if (!gameState.problem || gameState.userAnswer === "") return;
            
            const isCorrect = parseInt(gameState.userAnswer) === gameState.problem.answer;
            
            if (isCorrect) {
                if (answerDisplayEl) answerDisplayEl.classList.add('text-success');
                if (feedbackEl) {
                    const encouragements = ["Great job!", "You're amazing!", "Keep it up!", "Brilliant!", "Fantastic!"];
                    feedbackEl.textContent = encouragements[Math.floor(Math.random() * encouragements.length)];
                    feedbackEl.className = "text-success";
                }

                const points = gameState.difficulty === "easy" ? 10 : gameState.difficulty === "medium" ? 20 : 30;
                gameState.score += points + (gameState.streak * 5);
                gameState.streak++;

                if (gameState.streak > 0 && gameState.streak % 5 === 0) {
                    showCelebration();
                }

                setTimeout(generateProblem, 1000);
            } else {
                if (answerDisplayEl) answerDisplayEl.classList.add('text-destructive');
                if (feedbackEl) {
                    feedbackEl.textContent = "Try again!";
                    feedbackEl.className = "text-destructive";
                }
                
                gameState.streak = 0;
                setTimeout(() => {
                    if (feedbackEl) feedbackEl.textContent = '';
                    if (answerDisplayEl) answerDisplayEl.classList.remove('text-destructive');
                }, 1500);
            }
            updateGameUI();
        }

        function showCelebration() {
            if (!celebrationOverlay || !celebrationText) return;
            celebrationText.textContent = `${gameState.streak} in a row!`;
            celebrationOverlay.classList.add('active');
            setTimeout(() => {
                celebrationOverlay.classList.remove('active');
            }, 2000);
        }

        // Game Event Listeners
        difficultyButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                gameState.difficulty = btn.dataset.gameDifficulty;
                gameState.score = 0;
                gameState.streak = 0;
                gameState.started = true;
                generateProblem();
                updateGameUI();
            });
        });

        if (btnGameBack) btnGameBack.addEventListener('click', () => {
            gameState.started = false;
            updateGameUI();
        });

        if (btnGameCheck) btnGameCheck.addEventListener('click', checkAnswer);

        gameNumButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                if (gameState.userAnswer.length < 4) {
                    gameState.userAnswer += btn.dataset.gameNum;
                    updateGameUI();
                }
            });
        });

        if (btnGameClear) btnGameClear.addEventListener('click', () => {
            gameState.userAnswer = "";
            updateGameUI();
        });

        if (btnGameBackspace) btnGameBackspace.addEventListener('click', () => {
            gameState.userAnswer = gameState.userAnswer.slice(0, -1);
            updateGameUI();
        });

        // Initialization
        updateCalcDisplay();
        switchTab('calculator');
    });
    </script>
</body>
</html>